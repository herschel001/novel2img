# Novel2Img Chrome插件测试指南

## 🚀 快速开始

### 1. 安装插件

1. **打开Chrome浏览器**，进入 `chrome://extensions/`
2. **开启开发者模式**：点击右上角的"开发者模式"开关
3. **加载插件**：点击"加载已解压的扩展程序"
4. **选择项目文件夹**：选择 `/Users/hershel/code/novel2img` 目录
5. **确认安装**：插件应该出现在扩展程序列表中

### 2. 配置API密钥

1. **点击插件图标**：在浏览器工具栏找到Novel2Img图标
2. **打开设置**：点击弹窗右上角的设置按钮（⚙️）
3. **输入API密钥**：在API密钥字段输入：`ms-7bf36b6e-acbb-4d95-9d7f-fa707cc652fb`
4. **测试连接**：点击"测试连接"按钮验证密钥
5. **保存设置**：点击"保存设置"

## 🎯 功能测试

### 功能一：插件弹窗生成

1. **打开弹窗**：点击浏览器工具栏中的插件图标
2. **输入提示词**：在文本框中输入：`"坐在窗边写作业的少女，温暖的阳光，美丽的画面"`
3. **选择参数**：
   - 尺寸：选择 `1024x1024`
   - 模型：选择 `千问生图`
4. **开始生成**：点击"🚀 开始生成"按钮
5. **选择图片**：
   - 生成完成后会显示3张预览图
   - 点击选择你喜欢的那张图片
   - 选中状态会显示蓝色边框和勾号
6. **操作选择**：
   - **下载到本地**：点击"💾 下载到本地"按钮
   - **复制图片**：点击"📋 复制图片"按钮，然后可在任意编辑器中粘贴

### 功能二：图片复制粘贴

1. **生成图片**：按照上述步骤生成图片并选择
2. **复制图片**：点击"📋 复制图片"按钮
3. **粘贴使用**：在任意编辑器中按 Ctrl+V（或 Cmd+V）粘贴
4. **验证结果**：
   - 富文本编辑器：图片将直接显示
   - 普通文本编辑器：将粘贴图片文件或链接
   - 支持大部分现代浏览器和编辑器

### 功能三：历史记录管理

1. **查看历史**：在插件弹窗中查看"历史记录"区域
2. **点击历史项**：点击任意历史记录项
3. **自动填充**：提示词应该自动填充到输入框
4. **搜索功能**：在搜索框中输入关键词测试搜索

### 功能四：复制粘贴兼容性测试

1. **打开测试页面**：打开项目中的 `test.html` 文件
2. **测试富文本编辑器**：生成并复制图片，在 contenteditable 编辑器中粘贴
3. **测试普通文本框**：在 textarea 编辑器中粘贴测试
4. **测试其他网站**：在 GitHub、知乎、博客等网站测试复制粘贄功能

### 功能三：右键菜单

1. **选中文本**：在任意网页选中一段描述性文字
2. **右键菜单**：右键点击选中的文字
3. **选择生成**：点击"Novel2Img - 生成图片"
4. **选择尺寸**：选择子菜单中的图片尺寸
5. **自动生成**：系统应该使用选中的文字作为提示词生成图片

### 功能四：历史记录

1. **查看历史**：在插件弹窗中切换到"历史记录"标签
2. **点击历史项**：点击任意历史记录项
3. **自动填充**：提示词应该自动填充到输入框
4. **搜索功能**：在搜索框中输入关键词测试搜索

### 功能五：状态持久化测试

#### 测试场景一：生成中状态恢复
1. **开始生成**：输入提示词并点击开始生成
2. **切换标签页**：在生成过程中切换到其他标签页
3. **返回插件**：再次点击插件图标
4. **验证恢复**：应该看到生成进度和已耗时间

#### 测试场景二：生成结果恢复
1. **完成生成**：等待图片生成完成
2. **关闭浏览器**：关闭整个浏览器或标签页
3. **重新打开**：重新打开浏览器并点击插件
4. **验证恢复**：应该看到之前生成的图片结果

#### 测试场景三：超时检测
1. **模拟超时**：开始生成后等待5分钟以上
2. **重新打开**：重新打开插件
3. **验证提示**：应该显示超时错误提示

#### 测试场景四：自动清理
1. **生成图片**：完成一次正常的图片生成
2. **等待30分钟以上**：等待超过30分钟
3. **重新打开**：重新打开插件
4. **验证清理**：应该不再显示过期的状态

**状态恢复验证要点**：
- 生成中状态应显示已耗时间
- 结果状态应显示恢复提示（如"已恢复3分钟前生成的图片"）
- 所有图片和操作按钮应正常显示
- 超时情况下应清理状态并显示错误

## 🔧 开发测试

### 调试信息

1. **打开开发者工具**：按 F12 或右键→检查
2. **查看控制台**：
   - 应该看到 "Novel2Img Background Script 已加载"
   - 应该看到 "Novel2Img Content Script 已初始化"
   - 应该看到 "Novel2Img Popup 已初始化"

### 测试日志

生成图片时应该看到类似日志：
```
🚀 开始异步生成图片...
📝 提示词: "坐在窗边写作业的少女，温暖的阳光，美丽的画面"
🎨 模型: Qwen/Qwen-Image
📋 任务已提交，task_id: xxx
⏳ 等待生成完成...
🔍 检查任务状态 (1/60)...
📊 任务状态: RUNNING
✅ 生成成功！
⏱️ 总耗时: 12.5秒
```

### 错误处理测试

1. **测试无API密钥**：清空API密钥尝试生成
2. **测试无效密钥**：输入错误的API密钥
3. **测试空提示词**：不输入任何内容点击生成
4. **测试超长提示词**：输入超过500字符的提示词

## 📂 文件结构验证

确保以下文件结构正确：
```
novel2img/
├── manifest.json           ✓ Chrome插件配置
├── background/
│   └── background.js       ✓ 后台脚本
├── popup/
│   ├── popup.html          ✓ 弹窗HTML
│   ├── popup.css           ✓ 弹窗样式
│   └── popup.js            ✓ 弹窗逻辑
├── lib/
│   ├── api-client.js       ✓ API客户端
│   └── utils.js            ✓ 工具函数
└── icons/
    ├── icon16.png          ✓ 16x16图标
    ├── icon48.png          ✓ 48x48图标
    └── icon128.png         ✓ 128x128图标
```

## 🐛 常见问题

### 问题1：插件加载失败
**解决方案**：
1. 确认已开启开发者模式
2. 检查manifest.json文件是否有语法错误
3. 重新加载插件

### 问题2：API调用失败
**解决方案**：
1. 检查网络连接
2. 验证API密钥是否正确
3. 查看浏览器控制台错误信息

### 问题3：图片下载失败
**解决方案**：
1. 检查浏览器下载设置
2. 确认有足够的磁盘空间
3. 查看下载文件夹权限

## 🎯 验收清单

- [ ] 插件成功安装并显示在扩展程序列表
- [ ] API密钥配置成功并通过测试
- [ ] 弹窗界面正常显示和交互
- [ ] 图片生成成功显示3张预览图
- [ ] 图片选择功能正常工作
- [ ] 图片下载功能正常工作
- [ ] 图片复制功能正常工作
- [ ] 大图查看功能正常工作
- [ ] 历史记录正常保存和显示
- [ ] 状态持久化功能正常工作（生成中和结果状态恢复）
- [ ] 超时检测和自动清理正常工作
- [ ] 设置保存和应用正常
- [ ] 错误处理和提示正常
- [ ] 在不同网站上都能正常工作

## 🚀 下一步开发

当前版本(v1.0.0)已实现基础功能，接下来可以考虑：

1. **图标优化**：制作专业的PNG图标
2. **UI美化**：优化界面设计和动画效果
3. **功能扩展**：添加更多AI服务支持
4. **性能优化**：优化API调用和缓存机制
5. **用户体验**：添加快捷键、批量生成等功能

---

**🎉 现在就开始测试你的Novel2Img插件吧！**